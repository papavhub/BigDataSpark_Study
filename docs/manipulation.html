

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Data Manipulation: Features &mdash; Learning Apache Spark with Python  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/fix_rtd.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. Regression" href="regression.html" />
    <link rel="prev" title="7. Data Exploration" href="exploration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Learning Apache Spark with Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">2. Why Spark with Python ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">3. Configure Running Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">4. An Introduction to Apache Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="rdd.html">5. Programming with RDDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">6. Statistics and Linear Algebra Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploration.html">7. Data Exploration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Data Manipulation: Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#feature-extraction">8.1. Feature Extraction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tf-idf">8.1.1. TF-IDF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#countvectorizer">8.1.1.1. Countvectorizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hashingtf">8.1.1.2. HashingTF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#word2vec">8.1.2. Word2Vec</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#word-embeddings">8.1.2.1. Word Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-context-window">8.1.2.2. The Context Window</a></li>
<li class="toctree-l4"><a class="reference internal" href="#two-types-of-embedding-models">8.1.2.3. Two Types of Embedding Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#word-embedding-models-in-pyspark">8.1.2.4. Word Embedding Models in PySpark</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#featurehasher">8.1.3. FeatureHasher</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rformula">8.1.4. RFormula</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feature-transform">8.2. Feature Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tokenizer">8.2.1. Tokenizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stopwordsremover">8.2.2. StopWordsRemover</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ngram">8.2.3. NGram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binarizer">8.2.4. Binarizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bucketizer">8.2.5. Bucketizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantilediscretizer">8.2.6. QuantileDiscretizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stringindexer">8.2.7. StringIndexer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#labelconverter">8.2.8. labelConverter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectorindexer">8.2.9. VectorIndexer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectorassembler">8.2.10. VectorAssembler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#onehotencoder">8.2.11. OneHotEncoder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-and-creating-sparksession">8.2.11.1. Import and creating SparkSession</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">8.2.11.2. OneHotEncoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-get-dummy-variable">8.2.11.3. Application: Get Dummy Variable</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scaler">8.2.12. Scaler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#normalizer">8.2.12.1. Normalizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standardscaler">8.2.12.2. StandardScaler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minmaxscaler">8.2.12.3. MinMaxScaler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maxabsscaler">8.2.12.4. MaxAbsScaler</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pca">8.2.13. PCA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dct">8.2.14. DCT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feature-selection">8.3. Feature Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lasso">8.3.1. LASSO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#randomforest">8.3.2. RandomForest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unbalanced-data-undersampling">8.4. Unbalanced data: Undersampling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calculate-undersampling-ratio">8.4.1. Calculate undersampling Ratio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undersampling">8.4.2. Undersampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recalibrating-probability">8.4.3. Recalibrating Probability</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="regression.html">9. Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">10. Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification.html">11. Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">12. Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfm.html">13. RFM Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="textmining.html">14. Text Mining</a></li>
<li class="toctree-l1"><a class="reference internal" href="socialnetwork.html">15. Social Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="als.html">16. ALS: Stock Portfolio Recommendations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mc.html">17. Monte Carlo Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcmc.html">18. Markov Chain Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fnn.html">19. Neural Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto.html">20. Automation for Cloudera Distribution Hadoop</a></li>
<li class="toctree-l1"><a class="reference internal" href="pack.html">21. Wrap PySpark Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit.html">22. PySpark Data Audit Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ze2nb.html">23. Zeppelin to jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheat.html">24. My Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc.html">25. JDBC Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="bricks.html">26. Databricks Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">27. PySpark API</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">28. Main Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Learning Apache Spark with Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Data Manipulation: Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-manipulation-features">
<span id="manipulation"></span><h1><span class="section-number">8. </span>Data Manipulation: Features<a class="headerlink" href="#data-manipulation-features" title="Permalink to this headline">¶</a></h1>
<div class="admonition-chinese-proverb admonition">
<p class="admonition-title">Chinese proverb</p>
<p><strong>All things are diffcult before they are easy!</strong></p>
</div>
<p>Feature building is a super important step for modeling which will determine the success or failure of your model. Otherwise, you will get: garbage in; garbage out! The techniques have been covered in the following chapters, the followings are the brief summary. I recently found that the Spark official website did a really good job for tutorial documentation. The chapter is based on  <a class="reference external" href="https://spark.apache.org/docs/latest/ml-features">Extracting transforming and selecting features</a>.</p>
<div class="section" id="feature-extraction">
<h2><span class="section-number">8.1. </span>Feature Extraction<a class="headerlink" href="#feature-extraction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tf-idf">
<h3><span class="section-number">8.1.1. </span>TF-IDF<a class="headerlink" href="#tf-idf" title="Permalink to this headline">¶</a></h3>
<p>Term frequency-inverse document frequency (TF-IDF) is a feature vectorization method widely used in text mining to reflect the importance of a term to a document in the corpus. More details can be found at: <a class="reference external" href="https://spark.apache.org/docs/latest/ml-features#feature-extractors">https://spark.apache.org/docs/latest/ml-features#feature-extractors</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/35205865/what-is-the-difference-between-hashingtf-and-countvectorizer-in-spark">Stackoverflow TF</a>: Both HashingTF and CountVectorizer can be used to generate the term frequency vectors. A few important differences:</p>
<ol class="loweralpha simple">
<li><p>partially <strong>reversible</strong> (CountVectorizer) vs <strong>irreversible</strong> (HashingTF) - since hashing is not reversible you cannot restore original input from a hash vector. From the other hand count vector with model (index) can be used to restore unordered input. As a consequence models created using hashed input can be much harder to interpret and monitor.</p></li>
<li><p><strong>memory and computational overhead</strong> - HashingTF requires only a single data scan and no additional memory beyond original input and vector. CountVectorizer requires additional scan over the data to build a model and additional memory to store vocabulary (index). In case of unigram language model it is usually not a problem but in case of higher n-grams it can be prohibitively expensive or not feasible.</p></li>
<li><p>hashing <strong>depends on</strong> a size of the vector , hashing function and a document. Counting depends on a size of the vector, training corpus and a document.</p></li>
<li><p><strong>a source of the information loss</strong> - in case of HashingTF it is dimensionality reduction with possible collisions. CountVectorizer discards infrequent tokens. How it affects downstream models depends on a particular use case and data.</p></li>
</ol>
<p><strong>HashingTF</strong> and <strong>CountVectorizer</strong> are the two popular alogoritms which used to generate term frequency vectors. They basically convert documents into a numerical representation which can be fed directly or with further processing into other algorithms like LDA, MinHash for Jaccard Distance, Cosine Distance.</p>
<ul class="simple">
<li><p><img class="math" src="_images/math/044a3924bf0f1cafd261d1a82897918876420c66.png" alt="t"/>: term</p></li>
<li><p><img class="math" src="_images/math/7e5d704373066aba3721350997b4fe776ee27351.png" alt="d"/>: document</p></li>
<li><p><img class="math" src="_images/math/563323aea029cec3bcc688dc1baa7e6db75a11ac.png" alt="D"/>: corpus</p></li>
<li><p><img class="math" src="_images/math/6a1e3fd44d37cb504de51abd5c2229dc3f26dda0.png" alt="|D|"/>: the number of the elements in corpus</p></li>
<li><p><img class="math" src="_images/math/2692c45774421000419a4a5083584438562a3fb4.png" alt="TF(t,d)"/>: Term Frequency: the number of times that term <img class="math" src="_images/math/044a3924bf0f1cafd261d1a82897918876420c66.png" alt="t"/> appears in document <img class="math" src="_images/math/7e5d704373066aba3721350997b4fe776ee27351.png" alt="d"/></p></li>
<li><p><img class="math" src="_images/math/0441e242a38ff951605252e885e4bf84fbf9d147.png" alt="DF(t,D)"/>: Document Frequency: the number of documents that contains term <img class="math" src="_images/math/044a3924bf0f1cafd261d1a82897918876420c66.png" alt="t"/></p></li>
<li><p><img class="math" src="_images/math/33884e1aac0ffecdb67a3a7566c2edcf6a668d12.png" alt="IDF(t, D)"/>: Inverse Document Frequency is a numerical measure of how much information a term provides</p></li>
</ul>
<div class="math">
<p><img src="_images/math/ec9ae35cf9031edefb6c7adcbad7988bfc236911.png" alt="IDF(t, D) = \log \frac{|D| + 1}{DF(t, D) + 1}"/></p>
</div><ul class="simple">
<li><p><img class="math" src="_images/math/2bc77c9f427f9321a24584daeecef2c227060720.png" alt="TFIDF(t, d, D)"/> the product of TF and IDF</p></li>
</ul>
<div class="math">
<p><img src="_images/math/9dacdf577abe6239b7f7a2db4bd8d892f15a55b0.png" alt="TFIDF(t, d, D) = TF(t, d) \cdot IDF(t, D)"/></p>
</div><p>Let’s look at the example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Python python Spark Spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Python SQL&quot;</span><span class="p">)],</span>
 <span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sentenceData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">+--------+-------------------------+</span>
<span class="o">|</span><span class="n">document</span><span class="o">|</span><span class="n">sentence</span>                 <span class="o">|</span>
<span class="o">+--------+-------------------------+</span>
<span class="o">|</span><span class="mi">0</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">python</span> <span class="n">Spark</span> <span class="n">Spark</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">SQL</span>               <span class="o">|</span>
<span class="o">+--------+-------------------------+</span>
</pre></div>
</div>
<p>Then:</p>
<ul class="simple">
<li><p><img class="math" src="_images/math/fa824e49f0b52334a33a9a413b181385d4d5bd0d.png" alt="TF(python,document 1) = 1, TF(spark,document 1) = 2"/></p></li>
<li><p><img class="math" src="_images/math/c06f55770331eb9ec3d8d9b37fea1da7943867ad.png" alt="DF(Spark,D)= 2,  DF(sql,D)= 1"/></p></li>
<li><p>IDF:</p></li>
</ul>
<div class="math">
<p><img src="_images/math/60458d76e318439d3724e1de6c79ddf82d58f037.png" alt="IDF(python, D)= \log \frac{|D| + 1}{DF(t, D) + 1} =\log(\frac{2+1}{2+1}) =0"/></p>
</div><div class="math">
<p><img src="_images/math/a862ff8a34d550491ebb7e59ce95b66e0f582e35.png" alt="IDF(spark, D)= \log \frac{|D| + 1}{DF(t, D) + 1} =\log(\frac{2+1}{1+1}) =  0.4054651081081644"/></p>
</div><div class="math">
<p><img src="_images/math/f52fb39382564f2fe37f5d7986cf61d16862f8d5.png" alt="IDF(sql, D)= \log \frac{|D| + 1}{DF(t, D) + 1} =\log(\frac{2+1}{1+1}) = 0.4054651081081644"/></p>
</div><ul class="simple">
<li><p>TFIDF</p></li>
</ul>
<div class="math">
<p><img src="_images/math/81a3bb9e8ce8eb82ca03ecfef2700ade99adf8e9.png" alt="TFIDF(python, document 1, D) = 3*0 = 0"/></p>
</div><div class="math">
<p><img src="_images/math/342566969f8bf0096706471fd9a5a0cdac454839.png" alt="TFIDF(spark, document 1, D) = 2*0.4054651081081644 = 0.8109302162163288"/></p>
</div><div class="math">
<p><img src="_images/math/0028ec9e52ba82ddae65daeaa47c59ae537eb927.png" alt="TFIDF(sql, document 1, D) = 1*0.4054651081081644 = 0.4054651081081644"/></p>
</div><div class="section" id="countvectorizer">
<h4><span class="section-number">8.1.1.1. </span>Countvectorizer<a class="headerlink" href="#countvectorizer" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://stackoverflow.com/questions/35205865/what-is-the-difference-between-hashingtf-and-countvectorizer-in-spark">Stackoverflow TF</a>: CountVectorizer and CountVectorizerModel aim to help convert a collection of text documents to vectors of token counts. When an a-priori dictionary is not available, CountVectorizer can be used as an Estimator to extract the vocabulary, and generates a CountVectorizerModel. The model produces sparse representations for the documents over the vocabulary, which can then be passed to other algorithms like LDA.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Python python Spark Spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Python SQL&quot;</span><span class="p">)],</span>
 <span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence&quot;</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">vectorizer</span>  <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">)</span>

<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">vectorizer</span><span class="p">,</span> <span class="n">idf</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">total_counts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>\
                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span>\
                    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">toArray</span><span class="p">())</span>\
                    <span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))])</span>

<span class="n">vocabList</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vocabulary</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vocabList&#39;</span><span class="p">:</span><span class="n">vocabList</span><span class="p">,</span><span class="s1">&#39;counts&#39;</span><span class="p">:</span><span class="n">total_counts</span><span class="p">}</span>

<span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">counts</span>

<span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">rawFeatures</span><span class="o">=</span><span class="n">SparseVector</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})),</span>
 <span class="n">Row</span><span class="p">(</span><span class="n">rawFeatures</span><span class="o">=</span><span class="n">SparseVector</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})),</span>
 <span class="n">Row</span><span class="p">(</span><span class="n">rawFeatures</span><span class="o">=</span><span class="n">SparseVector</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}))]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---------+------+</span>
<span class="o">|</span><span class="n">vocabList</span><span class="o">|</span><span class="n">counts</span><span class="o">|</span>
<span class="o">+---------+------+</span>
<span class="o">|</span>   <span class="n">python</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>    <span class="n">spark</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>      <span class="n">sql</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+---------+------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
<span class="o">|</span><span class="n">document</span><span class="o">|</span><span class="n">sentence</span>                 <span class="o">|</span><span class="n">words</span>                         <span class="o">|</span><span class="n">rawFeatures</span>        <span class="o">|</span><span class="n">features</span>                          <span class="o">|</span>
<span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
<span class="o">|</span><span class="mi">0</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">python</span> <span class="n">Spark</span> <span class="n">Spark</span><span class="o">|</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">python</span><span class="p">,</span> <span class="n">spark</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.8109302162163288</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">SQL</span>               <span class="o">|</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">sql</span><span class="p">]</span>                 <span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.4054651081081644</span><span class="p">])</span><span class="o">|</span>
<span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">ArrayType</span><span class="p">,</span> <span class="n">StringType</span>

<span class="k">def</span> <span class="nf">termsIdx2Term</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">termsIdx2Term</span><span class="p">(</span><span class="n">termIndices</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">vocabulary</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">termIndices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">udf</span><span class="p">(</span><span class="n">termsIdx2Term</span><span class="p">,</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span>

<span class="n">vectorizerModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vocabList</span> <span class="o">=</span> <span class="n">vectorizerModel</span><span class="o">.</span><span class="n">vocabulary</span>
<span class="n">vocabList</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;spark&#39;</span><span class="p">,</span> <span class="s1">&#39;sql&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawFeatures</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">)</span>
<span class="n">rawFeatures</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="o">+-------------------+</span>
<span class="o">|</span>        <span class="n">rawFeatures</span><span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">+-------------------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span>  <span class="n">StringType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">IntegerType</span>

<span class="n">indices_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vector</span><span class="p">:</span> <span class="n">vector</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="n">values_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vector</span><span class="p">:</span> <span class="n">vector</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">()))</span>


<span class="n">rawFeatures</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="n">indices_udf</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">)))</span>\
           <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="n">values_udf</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;rawFeatures&#39;</span><span class="p">)))</span>\
           <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Terms&quot;</span><span class="p">,</span> <span class="n">termsIdx2Term</span><span class="p">(</span><span class="n">vocabList</span><span class="p">)(</span><span class="s2">&quot;indices&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-------------------+-------+---------------+---------------+</span>
<span class="o">|</span>        <span class="n">rawFeatures</span><span class="o">|</span><span class="n">indices</span><span class="o">|</span>         <span class="n">values</span><span class="o">|</span>          <span class="n">Terms</span><span class="o">|</span>
<span class="o">+-------------------+-------+---------------+---------------+</span>
<span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span><span class="o">|</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>  <span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">sql</span><span class="p">]</span><span class="o">|</span>
<span class="o">+-------------------+-------+---------------+---------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="hashingtf">
<h4><span class="section-number">8.1.1.2. </span>HashingTF<a class="headerlink" href="#hashingtf" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://stackoverflow.com/questions/35205865/what-is-the-difference-between-hashingtf-and-countvectorizer-in-spark">Stackoverflow TF</a>: HashingTF is a Transformer which takes sets of terms and converts those sets into fixed-length feature vectors. In text processing, a “set of terms” might be a bag of words. HashingTF utilizes the hashing trick. A raw feature is mapped into an index (term) by applying a hash function. The hash function used here is MurmurHash 3. Then term frequencies are calculated based on the mapped indices. This approach avoids the need to compute a global term-to-index map, which can be expensive for a large corpus, but it suffers from potential hash collisions, where different raw features may become the same term after hashing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Python python Spark Spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Python SQL&quot;</span><span class="p">)],</span>
 <span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence&quot;</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">vectorizer</span>  <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">numFeatures</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">vectorizer</span><span class="p">,</span> <span class="n">idf</span><span class="p">])</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
<span class="o">|</span><span class="n">document</span><span class="o">|</span><span class="n">sentence</span>                 <span class="o">|</span><span class="n">words</span>                         <span class="o">|</span><span class="n">rawFeatures</span>        <span class="o">|</span><span class="n">features</span>                          <span class="o">|</span>
<span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
<span class="o">|</span><span class="mi">0</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">python</span> <span class="n">Spark</span> <span class="n">Spark</span><span class="o">|</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">python</span><span class="p">,</span> <span class="n">spark</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span><span class="o">|</span><span class="p">(</span><span class="mi">5</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="mi">5</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mf">0.8109302162163288</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>       <span class="o">|</span><span class="n">Python</span> <span class="n">SQL</span>               <span class="o">|</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="n">sql</span><span class="p">]</span>                 <span class="o">|</span><span class="p">(</span><span class="mi">5</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="mi">5</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mf">0.4054651081081644</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">+--------+-------------------------+------------------------------+-------------------+----------------------------------+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="word2vec">
<h3><span class="section-number">8.1.2. </span>Word2Vec<a class="headerlink" href="#word2vec" title="Permalink to this headline">¶</a></h3>
<div class="section" id="word-embeddings">
<h4><span class="section-number">8.1.2.1. </span>Word Embeddings<a class="headerlink" href="#word-embeddings" title="Permalink to this headline">¶</a></h4>
<p><strong>Word2Vec</strong> is one of the popupar method to implement the <strong>Word Embeddings</strong>.  <a class="reference external" href="https://cbail.github.io/textasdata/word2vec/rmarkdown/word2vec.html">Word embeddings</a> (The best tutorial I have read. The following word and images content are from Chris Bail, PhD
Duke University. So the copyright belongs to Chris Bail, PhD
Duke University.) gained fame in the world of automated text analysis when it was demonstrated that they could be used to identify analogies. Figure 1 illustrates the output of a word embedding model where individual words are plotted in three dimensional space generated by the model. By examining the adjacency of words in this space, word embedding models can complete analogies such as “Man is to woman as king is to queen.” If you’d like to explore what the output of a large word embedding model looks like in more detail, check out this fantastic visualization of most words in the English language that was produced using a word embedding model called GloVE.</p>
<div class="figure align-center" id="id4">
<img alt="_images/w2v_1.png" src="_images/w2v_1.png" />
<p class="caption"><span class="caption-text">output of a word embedding model</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="the-context-window">
<h4><span class="section-number">8.1.2.2. </span>The Context Window<a class="headerlink" href="#the-context-window" title="Permalink to this headline">¶</a></h4>
<p>Word embeddings are created by identifying the words that occur within something called a “Context Window.” The Figure below illustrates context windows of varied length for a single sentence. The context window is defined by a string of words before and after a focal or “center” word that will be used to train a word embedding model. Each center word and context words can be represented as a vector of numbers that describe the presence or absence of unique words within a dataset, which is perhaps why word embedding models are often described as “word vector” models, or “word2vec” models.</p>
<div class="figure align-center">
<img alt="_images/w2v_2.png" src="_images/w2v_2.png" />
</div>
</div>
<div class="section" id="two-types-of-embedding-models">
<h4><span class="section-number">8.1.2.3. </span>Two Types of Embedding Models<a class="headerlink" href="#two-types-of-embedding-models" title="Permalink to this headline">¶</a></h4>
<p>Word embeddings are usually performed in one of two ways: “Continuous Bag of Words” (CBOW) or a “Skip-Gram Model.” The figure below illustrates the differences between the two models. The CBOW model reads in the context window words and tries to predict the most likely center word. The Skip-Gram Model predicts the context words given the center word. The examples above were created using the Skip-Gram model, which is perhaps most useful for people who want to identify patterns within texts to represent them in multimensional space, whereas the CBOW model is more useful in practical applications such as predictive web search.</p>
<div class="figure align-center">
<img alt="_images/w2v_3.png" src="_images/w2v_3.png" />
</div>
</div>
<div class="section" id="word-embedding-models-in-pyspark">
<h4><span class="section-number">8.1.2.4. </span>Word Embedding Models in PySpark<a class="headerlink" href="#word-embedding-models-in-pyspark" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Word2Vec</span>

<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">word2Vec</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">vectorSize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">word2Vec</span><span class="p">])</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+-----+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="n">label</span><span class="o">|</span>            <span class="n">sentence</span><span class="o">|</span>               <span class="n">words</span><span class="o">|</span>             <span class="n">feature</span><span class="o">|</span>
<span class="o">+-----+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>  <span class="mf">0.0</span><span class="o">|</span>        <span class="n">I</span> <span class="n">love</span> <span class="n">Spark</span><span class="o">|</span>    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">love</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.05594437588782</span><span class="o">...|</span>
<span class="o">|</span>  <span class="mf">0.0</span><span class="o">|</span>       <span class="n">I</span> <span class="n">love</span> <span class="n">python</span><span class="o">|</span>   <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">love</span><span class="p">,</span> <span class="n">python</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">0.0350368790871</span><span class="o">...|</span>
<span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span><span class="n">I</span> <span class="n">think</span> <span class="n">ML</span> <span class="ow">is</span> <span class="n">awe</span><span class="o">...|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">think</span><span class="p">,</span> <span class="n">ml</span><span class="p">,</span> <span class="ow">is</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01242086507845</span><span class="o">...|</span>
<span class="o">+-----+--------------------+--------------------+--------------------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w2v</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">w2v</span><span class="o">.</span><span class="n">getVectors</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="o">+-------+-----------------------------------------------------------------+</span>
<span class="o">|</span><span class="n">word</span>   <span class="o">|</span><span class="n">vector</span>                                                           <span class="o">|</span>
<span class="o">+-------+-----------------------------------------------------------------+</span>
<span class="o">|</span><span class="ow">is</span>     <span class="o">|</span><span class="p">[</span><span class="mf">0.13657838106155396</span><span class="p">,</span><span class="mf">0.060924094170331955</span><span class="p">,</span><span class="o">-</span><span class="mf">0.03379475697875023</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">awesome</span><span class="o">|</span><span class="p">[</span><span class="mf">0.037024181336164474</span><span class="p">,</span><span class="o">-</span><span class="mf">0.023855900391936302</span><span class="p">,</span><span class="mf">0.0760037824511528</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">i</span>      <span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">0.0014482572441920638</span><span class="p">,</span><span class="mf">0.049365971237421036</span><span class="p">,</span><span class="mf">0.12016955763101578</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="n">ml</span>     <span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">0.14006119966506958</span><span class="p">,</span><span class="mf">0.01626444421708584</span><span class="p">,</span><span class="mf">0.042281970381736755</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">spark</span>  <span class="o">|</span><span class="p">[</span><span class="mf">0.1589149385690689</span><span class="p">,</span><span class="o">-</span><span class="mf">0.10970081388950348</span><span class="p">,</span><span class="o">-</span><span class="mf">0.10547549277544022</span><span class="p">]</span>   <span class="o">|</span>
<span class="o">|</span><span class="n">think</span>  <span class="o">|</span><span class="p">[</span><span class="mf">0.030011219903826714</span><span class="p">,</span><span class="o">-</span><span class="mf">0.08994936943054199</span><span class="p">,</span><span class="mf">0.16471518576145172</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">love</span>   <span class="o">|</span><span class="p">[</span><span class="mf">0.01036644633859396</span><span class="p">,</span><span class="o">-</span><span class="mf">0.017782460898160934</span><span class="p">,</span><span class="mf">0.08870164304971695</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="n">python</span> <span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">0.11402882635593414</span><span class="p">,</span><span class="mf">0.045119188725948334</span><span class="p">,</span><span class="o">-</span><span class="mf">0.029877422377467155</span><span class="p">]</span><span class="o">|</span>
<span class="o">+-------+-----------------------------------------------------------------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">format_number</span> <span class="k">as</span> <span class="n">fmt</span>
<span class="n">w2v</span><span class="o">.</span><span class="n">findSynonyms</span><span class="p">(</span><span class="s2">&quot;could&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">(</span><span class="s2">&quot;similarity&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;similarity&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-------+----------+</span>
<span class="o">|</span>   <span class="n">word</span><span class="o">|</span><span class="n">similarity</span><span class="o">|</span>
<span class="o">+-------+----------+</span>
<span class="o">|</span><span class="n">classes</span><span class="o">|</span>   <span class="mf">0.90232</span><span class="o">|</span>
<span class="o">|</span>      <span class="n">i</span><span class="o">|</span>   <span class="mf">0.75424</span><span class="o">|</span>
<span class="o">+-------+----------+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="featurehasher">
<h3><span class="section-number">8.1.3. </span>FeatureHasher<a class="headerlink" href="#featurehasher" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">FeatureHasher</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;stringNum&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">])</span>

<span class="n">hasher</span> <span class="o">=</span> <span class="n">FeatureHasher</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;stringNum&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">],</span>
                       <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="n">featurized</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">featurized</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+----+-----+---------+------+--------------------------------------------------------+</span>
<span class="o">|</span><span class="n">real</span><span class="o">|</span><span class="nb">bool</span> <span class="o">|</span><span class="n">stringNum</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="n">features</span>                                                <span class="o">|</span>
<span class="o">+----+-----+---------+------+--------------------------------------------------------+</span>
<span class="o">|</span><span class="mf">2.2</span> <span class="o">|</span><span class="n">true</span> <span class="o">|</span><span class="mi">1</span>        <span class="o">|</span><span class="n">foo</span>   <span class="o">|</span><span class="p">(</span><span class="mi">262144</span><span class="p">,[</span><span class="mi">174475</span><span class="p">,</span><span class="mi">247670</span><span class="p">,</span><span class="mi">257907</span><span class="p">,</span><span class="mi">262126</span><span class="p">],[</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span><span class="mf">3.3</span> <span class="o">|</span><span class="n">false</span><span class="o">|</span><span class="mi">2</span>        <span class="o">|</span><span class="n">bar</span>   <span class="o">|</span><span class="p">(</span><span class="mi">262144</span><span class="p">,[</span><span class="mi">70644</span><span class="p">,</span><span class="mi">89673</span><span class="p">,</span><span class="mi">173866</span><span class="p">,</span><span class="mi">174475</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">3.3</span><span class="p">])</span>  <span class="o">|</span>
<span class="o">|</span><span class="mf">4.4</span> <span class="o">|</span><span class="n">false</span><span class="o">|</span><span class="mi">3</span>        <span class="o">|</span><span class="n">baz</span>   <span class="o">|</span><span class="p">(</span><span class="mi">262144</span><span class="p">,[</span><span class="mi">22406</span><span class="p">,</span><span class="mi">70644</span><span class="p">,</span><span class="mi">174475</span><span class="p">,</span><span class="mi">187923</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">4.4</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>  <span class="o">|</span>
<span class="o">|</span><span class="mf">5.5</span> <span class="o">|</span><span class="n">false</span><span class="o">|</span><span class="mi">4</span>        <span class="o">|</span><span class="n">foo</span>   <span class="o">|</span><span class="p">(</span><span class="mi">262144</span><span class="p">,[</span><span class="mi">70644</span><span class="p">,</span><span class="mi">101499</span><span class="p">,</span><span class="mi">174475</span><span class="p">,</span><span class="mi">257907</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span> <span class="o">|</span>
<span class="o">+----+-----+---------+------+--------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="rformula">
<h3><span class="section-number">8.1.4. </span>RFormula<a class="headerlink" href="#rformula" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">RFormula</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;clicked&quot;</span><span class="p">])</span>

<span class="n">formula</span> <span class="o">=</span> <span class="n">RFormula</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;clicked ~ country + hour&quot;</span><span class="p">,</span>
    <span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">output</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-----+</span>
<span class="o">|</span>  <span class="n">features</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+----------+-----+</span>
<span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">18.0</span><span class="p">]</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">12.0</span><span class="p">]</span><span class="o">|</span>  <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">15.0</span><span class="p">]</span><span class="o">|</span>  <span class="mf">0.0</span><span class="o">|</span>
<span class="o">+----------+-----+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="feature-transform">
<h2><span class="section-number">8.2. </span>Feature Transform<a class="headerlink" href="#feature-transform" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tokenizer">
<h3><span class="section-number">8.2.1. </span>Tokenizer<a class="headerlink" href="#tokenizer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Tokenizer</span><span class="p">,</span> <span class="n">RegexTokenizer</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>

<span class="n">sentenceDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Hi I heard about Spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;I wish Java could use case classes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Logistic,regression,models,are,neat&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence&quot;</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>

<span class="n">regexTokenizer</span> <span class="o">=</span> <span class="n">RegexTokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">W&quot;</span><span class="p">)</span>
<span class="c1"># alternatively, pattern=&quot;\\w+&quot;, gaps(False)</span>

<span class="n">countTokens</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">words</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">),</span> <span class="n">IntegerType</span><span class="p">())</span>

<span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceDataFrame</span><span class="p">)</span>
<span class="n">tokenized</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="s2">&quot;words&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="n">countTokens</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;words&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">regexTokenized</span> <span class="o">=</span> <span class="n">regexTokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceDataFrame</span><span class="p">)</span>
<span class="n">regexTokenized</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="s2">&quot;words&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="n">countTokens</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;words&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------+------------------------------------------+------+</span>
<span class="o">|</span><span class="n">sentence</span>                           <span class="o">|</span><span class="n">words</span>                                     <span class="o">|</span><span class="n">tokens</span><span class="o">|</span>
<span class="o">+-----------------------------------+------------------------------------------+------+</span>
<span class="o">|</span><span class="n">Hi</span> <span class="n">I</span> <span class="n">heard</span> <span class="n">about</span> <span class="n">Spark</span>             <span class="o">|</span><span class="p">[</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">heard</span><span class="p">,</span> <span class="n">about</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span>              <span class="o">|</span><span class="mi">5</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">I</span> <span class="n">wish</span> <span class="n">Java</span> <span class="n">could</span> <span class="n">use</span> <span class="n">case</span> <span class="n">classes</span> <span class="o">|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">wish</span><span class="p">,</span> <span class="n">java</span><span class="p">,</span> <span class="n">could</span><span class="p">,</span> <span class="n">use</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">classes</span><span class="p">]</span><span class="o">|</span><span class="mi">7</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">Logistic</span><span class="p">,</span><span class="n">regression</span><span class="p">,</span><span class="n">models</span><span class="p">,</span><span class="n">are</span><span class="p">,</span><span class="n">neat</span><span class="o">|</span><span class="p">[</span><span class="n">logistic</span><span class="p">,</span><span class="n">regression</span><span class="p">,</span><span class="n">models</span><span class="p">,</span><span class="n">are</span><span class="p">,</span><span class="n">neat</span><span class="p">]</span>     <span class="o">|</span><span class="mi">1</span>     <span class="o">|</span>
<span class="o">+-----------------------------------+------------------------------------------+------+</span>

<span class="o">+-----------------------------------+------------------------------------------+------+</span>
<span class="o">|</span><span class="n">sentence</span>                           <span class="o">|</span><span class="n">words</span>                                     <span class="o">|</span><span class="n">tokens</span><span class="o">|</span>
<span class="o">+-----------------------------------+------------------------------------------+------+</span>
<span class="o">|</span><span class="n">Hi</span> <span class="n">I</span> <span class="n">heard</span> <span class="n">about</span> <span class="n">Spark</span>             <span class="o">|</span><span class="p">[</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">heard</span><span class="p">,</span> <span class="n">about</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span>              <span class="o">|</span><span class="mi">5</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">I</span> <span class="n">wish</span> <span class="n">Java</span> <span class="n">could</span> <span class="n">use</span> <span class="n">case</span> <span class="n">classes</span> <span class="o">|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">wish</span><span class="p">,</span> <span class="n">java</span><span class="p">,</span> <span class="n">could</span><span class="p">,</span> <span class="n">use</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">classes</span><span class="p">]</span><span class="o">|</span><span class="mi">7</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">Logistic</span><span class="p">,</span><span class="n">regression</span><span class="p">,</span><span class="n">models</span><span class="p">,</span><span class="n">are</span><span class="p">,</span><span class="n">neat</span><span class="o">|</span><span class="p">[</span><span class="n">logistic</span><span class="p">,</span> <span class="n">regression</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">are</span><span class="p">,</span> <span class="n">neat</span><span class="p">]</span> <span class="o">|</span><span class="mi">5</span>     <span class="o">|</span>
<span class="o">+-----------------------------------+------------------------------------------+------+</span>
</pre></div>
</div>
</div>
<div class="section" id="stopwordsremover">
<h3><span class="section-number">8.2.2. </span>StopWordsRemover<a class="headerlink" href="#stopwordsremover" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StopWordsRemover</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;saw&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;balloon&quot;</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Mary&quot;</span><span class="p">,</span> <span class="s2">&quot;had&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;little&quot;</span><span class="p">,</span> <span class="s2">&quot;lamb&quot;</span><span class="p">])</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">])</span>

<span class="n">remover</span> <span class="o">=</span> <span class="n">StopWordsRemover</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;removeded&quot;</span><span class="p">)</span>
<span class="n">remover</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+----------------------------+--------------------+</span>
<span class="o">|</span><span class="nb">id</span> <span class="o">|</span><span class="n">raw</span>                         <span class="o">|</span><span class="n">removeded</span>           <span class="o">|</span>
<span class="o">+---+----------------------------+--------------------+</span>
<span class="o">|</span><span class="mi">0</span>  <span class="o">|</span><span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">saw</span><span class="p">,</span> <span class="n">the</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">balloon</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="n">saw</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">balloon</span><span class="p">]</span> <span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>  <span class="o">|</span><span class="p">[</span><span class="n">Mary</span><span class="p">,</span> <span class="n">had</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">little</span><span class="p">,</span> <span class="n">lamb</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">Mary</span><span class="p">,</span> <span class="n">little</span><span class="p">,</span> <span class="n">lamb</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+----------------------------+--------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="ngram">
<h3><span class="section-number">8.2.3. </span>NGram<a class="headerlink" href="#ngram" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">NGram</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;I love Spark&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;I love python&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;I think ML is awesome&quot;</span><span class="p">)],</span>
 <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence&quot;</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;sentence&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">ngram</span> <span class="o">=</span> <span class="n">NGram</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;ngrams&quot;</span><span class="p">)</span>

<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">ngram</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+---------------------+---------------------------+--------------------------------------+</span>
<span class="o">|</span><span class="n">label</span><span class="o">|</span><span class="n">sentence</span>             <span class="o">|</span><span class="n">words</span>                      <span class="o">|</span><span class="n">ngrams</span>                                <span class="o">|</span>
<span class="o">+-----+---------------------+---------------------------+--------------------------------------+</span>
<span class="o">|</span><span class="mf">0.0</span>  <span class="o">|</span><span class="n">I</span> <span class="n">love</span> <span class="n">Spark</span>         <span class="o">|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">love</span><span class="p">,</span> <span class="n">spark</span><span class="p">]</span>           <span class="o">|</span><span class="p">[</span><span class="n">i</span> <span class="n">love</span><span class="p">,</span> <span class="n">love</span> <span class="n">spark</span><span class="p">]</span>                  <span class="o">|</span>
<span class="o">|</span><span class="mf">0.0</span>  <span class="o">|</span><span class="n">I</span> <span class="n">love</span> <span class="n">python</span>        <span class="o">|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">love</span><span class="p">,</span> <span class="n">python</span><span class="p">]</span>          <span class="o">|</span><span class="p">[</span><span class="n">i</span> <span class="n">love</span><span class="p">,</span> <span class="n">love</span> <span class="n">python</span><span class="p">]</span>                 <span class="o">|</span>
<span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="n">I</span> <span class="n">think</span> <span class="n">ML</span> <span class="ow">is</span> <span class="n">awesome</span><span class="o">|</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">think</span><span class="p">,</span> <span class="n">ml</span><span class="p">,</span> <span class="ow">is</span><span class="p">,</span> <span class="n">awesome</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">i</span> <span class="n">think</span><span class="p">,</span> <span class="n">think</span> <span class="n">ml</span><span class="p">,</span> <span class="n">ml</span> <span class="ow">is</span><span class="p">,</span> <span class="ow">is</span> <span class="n">awesome</span><span class="p">]</span><span class="o">|</span>
<span class="o">+-----+---------------------+---------------------------+--------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="binarizer">
<h3><span class="section-number">8.2.4. </span>Binarizer<a class="headerlink" href="#binarizer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Binarizer</span>

<span class="n">continuousDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">])</span>

<span class="n">binarizer</span> <span class="o">=</span> <span class="n">Binarizer</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;binarized_feature&quot;</span><span class="p">)</span>

<span class="n">binarizedDataFrame</span> <span class="o">=</span> <span class="n">binarizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">continuousDataFrame</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Binarizer output with Threshold = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">binarizer</span><span class="o">.</span><span class="n">getThreshold</span><span class="p">())</span>
<span class="n">binarizedDataFrame</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Binarizer</span> <span class="n">output</span> <span class="k">with</span> <span class="n">Threshold</span> <span class="o">=</span> <span class="mf">0.500000</span>
<span class="o">+---+-------+-----------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">feature</span><span class="o">|</span><span class="n">binarized_feature</span><span class="o">|</span>
<span class="o">+---+-------+-----------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>    <span class="mf">0.1</span><span class="o">|</span>              <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>    <span class="mf">0.8</span><span class="o">|</span>              <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>    <span class="mf">0.2</span><span class="o">|</span>              <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>    <span class="mf">0.5</span><span class="o">|</span>              <span class="mf">0.0</span><span class="o">|</span>
<span class="o">+---+-------+-----------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="bucketizer">
<h3><span class="section-number">8.2.5. </span>Bucketizer<a class="headerlink" href="#bucketizer" title="Permalink to this headline">¶</a></h3>
<p>[Bucketizer](<a class="reference external" href="https://spark.apache.org/docs/latest/ml-features.html#bucketizer">https://spark.apache.org/docs/latest/ml-features.html#bucketizer</a>) transforms a column of continuous features to a column of feature buckets, where the buckets are specified by users.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">QuantileDiscretizer</span><span class="p">,</span> <span class="n">Bucketizer</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>

<span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span>
<span class="n">result_bucketizer</span> <span class="o">=</span> <span class="n">Bucketizer</span><span class="p">(</span><span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;result&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result_bucketizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+----+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span>
<span class="o">+---+----+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span> <span class="mf">2.0</span><span class="o">|</span>
<span class="o">+---+----+</span>

<span class="kc">None</span>
<span class="o">+---+----+------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">result</span><span class="o">|</span>
<span class="o">+---+----+------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span> <span class="mf">2.0</span><span class="o">|</span>   <span class="mf">0.0</span><span class="o">|</span>
<span class="o">+---+----+------+</span>
</pre></div>
</div>
</div>
<div class="section" id="quantilediscretizer">
<h3><span class="section-number">8.2.6. </span>QuantileDiscretizer<a class="headerlink" href="#quantilediscretizer" title="Permalink to this headline">¶</a></h3>
<p>QuantileDiscretizer takes a column with continuous features and outputs a column with binned categorical features. The number of bins is set by the numBuckets parameter. It is possible that the number of buckets used will be smaller than this value, for example, if there are too few distinct values of the input to create enough distinct quantiles.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">QuantileDiscretizer</span><span class="p">,</span> <span class="n">Bucketizer</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>

<span class="n">qds</span> <span class="o">=</span> <span class="n">QuantileDiscretizer</span><span class="p">(</span><span class="n">numBuckets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;buckets&quot;</span><span class="p">,</span>
                               <span class="n">relativeError</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<span class="n">bucketizer</span> <span class="o">=</span> <span class="n">qds</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">bucketizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">bucketizer</span><span class="o">.</span><span class="n">setHandleInvalid</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+----+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span>
<span class="o">+---+----+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span> <span class="mf">2.0</span><span class="o">|</span>
<span class="o">+---+----+</span>

<span class="kc">None</span>
<span class="o">+---+----+-------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">buckets</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span> <span class="mf">2.0</span><span class="o">|</span>    <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>

<span class="o">+---+----+-------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">buckets</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span> <span class="mf">2.0</span><span class="o">|</span>    <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
</pre></div>
</div>
<p>If the data has NULL values, then you will get the following results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">QuantileDiscretizer</span><span class="p">,</span> <span class="n">Bucketizer</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>

<span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span>
<span class="n">result_bucketizer</span> <span class="o">=</span> <span class="n">Bucketizer</span><span class="p">(</span><span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span>
                               <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;result&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result_bucketizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">qds</span> <span class="o">=</span> <span class="n">QuantileDiscretizer</span><span class="p">(</span><span class="n">numBuckets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;buckets&quot;</span><span class="p">,</span>
                               <span class="n">relativeError</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<span class="n">bucketizer</span> <span class="o">=</span> <span class="n">qds</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">bucketizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">bucketizer</span><span class="o">.</span><span class="n">setHandleInvalid</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+----+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span>
<span class="o">+---+----+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span><span class="n">null</span><span class="o">|</span>
<span class="o">+---+----+</span>

<span class="kc">None</span>
<span class="o">+---+----+------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">result</span><span class="o">|</span>
<span class="o">+---+----+------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span><span class="n">null</span><span class="o">|</span>  <span class="n">null</span><span class="o">|</span>
<span class="o">+---+----+------+</span>

<span class="o">+---+----+-------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">buckets</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>    <span class="mf">4.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>    <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span><span class="n">null</span><span class="o">|</span>   <span class="n">null</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>

<span class="o">+---+----+-------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span> <span class="n">age</span><span class="o">|</span><span class="n">buckets</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="mf">18.0</span><span class="o">|</span>    <span class="mf">3.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="mf">19.0</span><span class="o">|</span>    <span class="mf">4.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span> <span class="mf">8.0</span><span class="o">|</span>    <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span> <span class="mf">5.0</span><span class="o">|</span>    <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+---+----+-------+</span>
</pre></div>
</div>
</div>
<div class="section" id="stringindexer">
<h3><span class="section-number">8.2.7. </span>StringIndexer<a class="headerlink" href="#stringindexer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;categoryIndex&quot;</span><span class="p">)</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">indexed</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">category</span><span class="o">|</span><span class="n">categoryIndex</span><span class="o">|</span>
<span class="o">+---+--------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="n">b</span><span class="o">|</span>          <span class="mf">2.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+---+--------+-------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="labelconverter">
<h3><span class="section-number">8.2.8. </span>labelConverter<a class="headerlink" href="#labelconverter" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;labelIndex&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transformed string column &#39;</span><span class="si">%s</span><span class="s2">&#39; to indexed column &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">getInputCol</span><span class="p">(),</span> <span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()))</span>
<span class="n">indexed</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;StringIndexer will store labels in output column metadata</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">converter</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;labelIndex&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;originalLabel&quot;</span><span class="p">)</span>
<span class="n">converted</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">indexed</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transformed indexed column &#39;</span><span class="si">%s</span><span class="s2">&#39; back to original string column &#39;</span><span class="si">%s</span><span class="s2">&#39; using &quot;</span>
      <span class="s2">&quot;labels in metadata&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">converter</span><span class="o">.</span><span class="n">getInputCol</span><span class="p">(),</span> <span class="n">converter</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()))</span>
<span class="n">converted</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;labelIndex&quot;</span><span class="p">,</span> <span class="s2">&quot;originalLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Transformed</span> <span class="n">string</span> <span class="n">column</span> <span class="s1">&#39;label&#39;</span> <span class="n">to</span> <span class="n">indexed</span> <span class="n">column</span> <span class="s1">&#39;labelIndex&#39;</span>
<span class="o">+---+-----+----------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span><span class="n">labelIndex</span><span class="o">|</span>
<span class="o">+---+-----+----------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>
<span class="o">+---+-----+----------+</span>

<span class="n">StringIndexer</span> <span class="n">will</span> <span class="n">store</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">output</span> <span class="n">column</span> <span class="n">metadata</span>

<span class="n">Transformed</span> <span class="n">indexed</span> <span class="n">column</span> <span class="s1">&#39;labelIndex&#39;</span> <span class="n">back</span> <span class="n">to</span> <span class="n">original</span> <span class="n">string</span> <span class="n">column</span> <span class="s1">&#39;originalLabel&#39;</span> <span class="n">using</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">metadata</span>
<span class="o">+---+----------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">labelIndex</span><span class="o">|</span><span class="n">originalLabel</span><span class="o">|</span>
<span class="o">+---+----------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">+---+----------+-------------+</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;labelIndex&quot;</span><span class="p">)</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;labelIndex&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;originalLabel&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">indexer</span><span class="p">,</span> <span class="n">converter</span><span class="p">])</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+-----+----------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span><span class="n">labelIndex</span><span class="o">|</span><span class="n">originalLabel</span><span class="o">|</span>
<span class="o">+---+-----+----------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>       <span class="mf">1.0</span><span class="o">|</span>          <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>       <span class="mf">0.0</span><span class="o">|</span>           <span class="n">No</span><span class="o">|</span>
<span class="o">+---+-----+----------+-------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="vectorindexer">
<h3><span class="section-number">8.2.9. </span>VectorIndexer<a class="headerlink" href="#vectorindexer" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">RFormula</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s1">&#39;CHN&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s1">&#39;AUS&#39;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;stringNum&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>

<span class="n">formula</span> <span class="o">=</span> <span class="n">RFormula</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s2">&quot;label ~ real + bool + stringNum + string + country&quot;</span><span class="p">,</span>
    <span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>

<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># We specify maxCategories so features with &gt; 4 distinct values</span>
<span class="c1"># are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span> <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> \
                               <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span>\
                               <span class="n">maxCategories</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">formula</span><span class="p">,</span> <span class="n">featureIndexer</span><span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+----+-----+---------+------+-------+--------------------+--------------------+</span>
<span class="o">|</span><span class="n">label</span><span class="o">|</span><span class="n">real</span><span class="o">|</span> <span class="nb">bool</span><span class="o">|</span><span class="n">stringNum</span><span class="o">|</span><span class="n">string</span><span class="o">|</span><span class="n">country</span><span class="o">|</span>            <span class="n">features</span><span class="o">|</span>     <span class="n">indexedFeatures</span><span class="o">|</span>
<span class="o">+-----+----+-----+---------+------+-------+--------------------+--------------------+</span>
<span class="o">|</span>    <span class="mi">0</span><span class="o">|</span> <span class="mf">2.2</span><span class="o">|</span> <span class="n">true</span><span class="o">|</span>        <span class="mi">1</span><span class="o">|</span>   <span class="n">foo</span><span class="o">|</span>     <span class="n">CA</span><span class="o">|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mf">2.</span><span class="o">...|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mf">2.</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">1</span><span class="o">|</span> <span class="mf">3.3</span><span class="o">|</span><span class="n">false</span><span class="o">|</span>        <span class="mi">2</span><span class="o">|</span>   <span class="n">bar</span><span class="o">|</span>     <span class="n">US</span><span class="o">|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mf">3.3</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mf">3.3</span><span class="p">,</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">0</span><span class="o">|</span> <span class="mf">4.4</span><span class="o">|</span><span class="n">false</span><span class="o">|</span>        <span class="mi">3</span><span class="o">|</span>   <span class="n">baz</span><span class="o">|</span>    <span class="n">CHN</span><span class="o">|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mf">4.</span><span class="o">...|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mf">4.</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">1</span><span class="o">|</span> <span class="mf">5.5</span><span class="o">|</span><span class="n">false</span><span class="o">|</span>        <span class="mi">4</span><span class="o">|</span>   <span class="n">foo</span><span class="o">|</span>    <span class="n">AUS</span><span class="o">|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mf">5.5</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">10</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mf">5.5</span><span class="p">,</span><span class="o">...|</span>
<span class="o">+-----+----+-----+---------+------+-------+--------------------+--------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="vectorassembler">
<h3><span class="section-number">8.2.10. </span>VectorAssembler<a class="headerlink" href="#vectorassembler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorAssembler</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;mobile&quot;</span><span class="p">,</span> <span class="s2">&quot;userFeatures&quot;</span><span class="p">,</span> <span class="s2">&quot;clicked&quot;</span><span class="p">])</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;mobile&quot;</span><span class="p">,</span> <span class="s2">&quot;userFeatures&quot;</span><span class="p">],</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assembled columns &#39;hour&#39;, &#39;mobile&#39;, &#39;userFeatures&#39; to vector column &#39;features&#39;&quot;</span><span class="p">)</span>
<span class="n">output</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;clicked&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Assembled</span> <span class="n">columns</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;userFeatures&#39;</span> <span class="n">to</span> <span class="n">vector</span> <span class="n">column</span> <span class="s1">&#39;features&#39;</span>
<span class="o">+-----------------------+-------+</span>
<span class="o">|</span><span class="n">features</span>               <span class="o">|</span><span class="n">clicked</span><span class="o">|</span>
<span class="o">+-----------------------+-------+</span>
<span class="o">|</span><span class="p">[</span><span class="mf">18.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span><span class="o">|</span><span class="mf">1.0</span>    <span class="o">|</span>
<span class="o">+-----------------------+-------+</span>
</pre></div>
</div>
</div>
<div class="section" id="onehotencoder">
<h3><span class="section-number">8.2.11. </span>OneHotEncoder<a class="headerlink" href="#onehotencoder" title="Permalink to this headline">¶</a></h3>
<p>This is the note I wrote for one of my readers for explaining the OneHotEncoder. I would like to share it at here:</p>
<div class="section" id="import-and-creating-sparksession">
<h4><span class="section-number">8.2.11.1. </span>Import and creating SparkSession<a class="headerlink" href="#import-and-creating-sparksession" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark create RDD example&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.some.config.option&quot;</span><span class="p">,</span> <span class="s2">&quot;some-value&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">category</span><span class="o">|</span>
<span class="o">+---+--------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="n">b</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>
<span class="o">+---+--------+</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4><span class="section-number">8.2.11.2. </span>OneHotEncoder<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="encoder">
<h5><span class="section-number">8.2.11.2.1. </span>Encoder<a class="headerlink" href="#encoder" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StringIndexer</span>


<span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;categoryIndex&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># default setting: dropLast=True</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;categoryIndex&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;categoryVec&quot;</span><span class="p">,</span><span class="n">dropLast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">encoded</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------+-------------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">category</span><span class="o">|</span><span class="n">categoryIndex</span><span class="o">|</span>  <span class="n">categoryVec</span><span class="o">|</span>
<span class="o">+---+--------+-------------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="n">b</span><span class="o">|</span>          <span class="mf">2.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">2</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">+---+--------+-------------+-------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default setting of <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> is: dropLast=True</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># default setting: dropLast=True</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;categoryIndex&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;categoryVec&quot;</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">encoded</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------+-------------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">category</span><span class="o">|</span><span class="n">categoryIndex</span><span class="o">|</span>  <span class="n">categoryVec</span><span class="o">|</span>
<span class="o">+---+--------+-------------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="n">b</span><span class="o">|</span>          <span class="mf">2.0</span><span class="o">|</span>    <span class="p">(</span><span class="mi">2</span><span class="p">,[],[])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>          <span class="mf">0.0</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>          <span class="mf">1.0</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span>
<span class="o">+---+--------+-------------+-------------+</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="vector-assembler">
<h5><span class="section-number">8.2.11.2.2. </span>Vector Assembler<a class="headerlink" href="#vector-assembler" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorAssembler</span>
<span class="n">categoricalCols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span>

<span class="n">indexers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_indexed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categoricalCols</span> <span class="p">]</span>
<span class="c1"># default setting: dropLast=True</span>
<span class="n">encoders</span> <span class="o">=</span> <span class="p">[</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">(),</span>
                 <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_encoded&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()),</span><span class="n">dropLast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span> <span class="p">]</span>
<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="n">encoder</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()</span> <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">encoders</span><span class="p">]</span>
                            <span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">indexers</span> <span class="o">+</span> <span class="n">encoders</span> <span class="o">+</span> <span class="p">[</span><span class="n">assembler</span><span class="p">])</span>

<span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+---+--------+----------------+------------------------+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">category</span><span class="o">|</span><span class="n">category_indexed</span><span class="o">|</span><span class="n">category_indexed_encoded</span><span class="o">|</span>     <span class="n">features</span><span class="o">|</span>
<span class="o">+---+--------+----------------+------------------------+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>             <span class="mf">0.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>       <span class="n">b</span><span class="o">|</span>             <span class="mf">2.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">2</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>             <span class="mf">1.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>             <span class="mf">0.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>       <span class="n">a</span><span class="o">|</span>             <span class="mf">0.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>       <span class="n">c</span><span class="o">|</span>             <span class="mf">1.0</span><span class="o">|</span>           <span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mf">1.0</span><span class="p">])</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+--------+----------------+------------------------+-------------+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="application-get-dummy-variable">
<h4><span class="section-number">8.2.11.3. </span>Application: Get Dummy Variable<a class="headerlink" href="#application-get-dummy-variable" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_dummy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">indexCol</span><span class="p">,</span><span class="n">categoricalCols</span><span class="p">,</span><span class="n">continuousCols</span><span class="p">,</span><span class="n">labelCol</span><span class="p">,</span><span class="n">dropLast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get dummy variables and concat with continuous variables for ml modeling.</span>
<span class="sd">    :param df: the dataframe</span>
<span class="sd">    :param categoricalCols: the name list of the categorical data</span>
<span class="sd">    :param continuousCols:  the name list of the numerical data</span>
<span class="sd">    :param labelCol:  the name of label column</span>
<span class="sd">    :param dropLast:  the flag of drop last column</span>
<span class="sd">    :return: feature matrix</span>

<span class="sd">    :author: Wenqiang Feng</span>
<span class="sd">    :email:  von198@gmail.com</span>

<span class="sd">    &gt;&gt;&gt; df = spark.createDataFrame([</span>
<span class="sd">                  (0, &quot;a&quot;),</span>
<span class="sd">                  (1, &quot;b&quot;),</span>
<span class="sd">                  (2, &quot;c&quot;),</span>
<span class="sd">                  (3, &quot;a&quot;),</span>
<span class="sd">                  (4, &quot;a&quot;),</span>
<span class="sd">                  (5, &quot;c&quot;)</span>
<span class="sd">              ], [&quot;id&quot;, &quot;category&quot;])</span>

<span class="sd">    &gt;&gt;&gt; indexCol = &#39;id&#39;</span>
<span class="sd">    &gt;&gt;&gt; categoricalCols = [&#39;category&#39;]</span>
<span class="sd">    &gt;&gt;&gt; continuousCols = []</span>
<span class="sd">    &gt;&gt;&gt; labelCol = []</span>

<span class="sd">    &gt;&gt;&gt; mat = get_dummy(df,indexCol,categoricalCols,continuousCols,labelCol)</span>
<span class="sd">    &gt;&gt;&gt; mat.show()</span>

<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">        +---+-------------+</span>
<span class="sd">        | id|     features|</span>
<span class="sd">        +---+-------------+</span>
<span class="sd">        |  0|[1.0,0.0,0.0]|</span>
<span class="sd">        |  1|[0.0,0.0,1.0]|</span>
<span class="sd">        |  2|[0.0,1.0,0.0]|</span>
<span class="sd">        |  3|[1.0,0.0,0.0]|</span>
<span class="sd">        |  4|[1.0,0.0,0.0]|</span>
<span class="sd">        |  5|[0.0,1.0,0.0]|</span>
<span class="sd">        +---+-------------+</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">VectorAssembler</span>
    <span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

    <span class="n">indexers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_indexed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categoricalCols</span> <span class="p">]</span>

    <span class="c1"># default setting: dropLast=True</span>
    <span class="n">encoders</span> <span class="o">=</span> <span class="p">[</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">(),</span>
                 <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_encoded&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">indexer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()),</span><span class="n">dropLast</span><span class="o">=</span><span class="n">dropLast</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">indexer</span> <span class="ow">in</span> <span class="n">indexers</span> <span class="p">]</span>

    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="n">encoder</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()</span> <span class="k">for</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="n">encoders</span><span class="p">]</span>
                                <span class="o">+</span> <span class="n">continuousCols</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">indexers</span> <span class="o">+</span> <span class="n">encoders</span> <span class="o">+</span> <span class="p">[</span><span class="n">assembler</span><span class="p">])</span>

    <span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">indexCol</span> <span class="ow">and</span> <span class="n">labelCol</span><span class="p">:</span>
        <span class="c1"># for supervised learning</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">(</span><span class="n">labelCol</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">indexCol</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">indexCol</span> <span class="ow">and</span> <span class="n">labelCol</span><span class="p">:</span>
        <span class="c1"># for supervised learning</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">(</span><span class="n">labelCol</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">indexCol</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labelCol</span><span class="p">:</span>
        <span class="c1"># for unsupervised learning</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">indexCol</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">indexCol</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labelCol</span><span class="p">:</span>
        <span class="c1"># for unsupervised learning</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="unsupervised-scenario">
<h5><span class="section-number">8.2.11.3.1. </span>Unsupervised scenario<a class="headerlink" href="#unsupervised-scenario" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">indexCol</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
<span class="n">categoricalCols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span>
<span class="n">continuousCols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">labelCol</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">get_dummy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">indexCol</span><span class="p">,</span><span class="n">categoricalCols</span><span class="p">,</span><span class="n">continuousCols</span><span class="p">,</span><span class="n">labelCol</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="o">+---+-------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span>     <span class="n">features</span><span class="o">|</span>
<span class="o">+---+-------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+-------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="supervised-scenario">
<h5><span class="section-number">8.2.11.3.2. </span>Supervised scenario<a class="headerlink" href="#supervised-scenario" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;bank.csv&#39;</span><span class="p">,</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">indexCol</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">catCols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">,</span><span class="s1">&#39;marital&#39;</span><span class="p">,</span><span class="s1">&#39;education&#39;</span><span class="p">,</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
           <span class="s1">&#39;housing&#39;</span><span class="p">,</span><span class="s1">&#39;loan&#39;</span><span class="p">,</span><span class="s1">&#39;contact&#39;</span><span class="p">,</span><span class="s1">&#39;poutcome&#39;</span><span class="p">]</span>

<span class="n">contCols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span><span class="s1">&#39;campaign&#39;</span><span class="p">,</span><span class="s1">&#39;pdays&#39;</span><span class="p">,</span><span class="s1">&#39;previous&#39;</span><span class="p">]</span>
<span class="n">labelCol</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">get_dummy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">indexCol</span><span class="p">,</span><span class="n">catCols</span><span class="p">,</span><span class="n">contCols</span><span class="p">,</span><span class="n">labelCol</span><span class="p">,</span><span class="n">dropLast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+-----+</span>
<span class="o">|</span>            <span class="n">features</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+--------------------+-----+</span>
<span class="o">|</span><span class="p">(</span><span class="mi">37</span><span class="p">,[</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span>   <span class="n">no</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">37</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span>   <span class="n">no</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">37</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span>   <span class="n">no</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">37</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span>   <span class="n">no</span><span class="o">|</span>
<span class="o">|</span><span class="p">(</span><span class="mi">37</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span>   <span class="n">no</span><span class="o">|</span>
<span class="o">+--------------------+-----+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<p>The Jupyter Notebook can be found on Colab: <a class="reference external" href="https://colab.research.google.com/drive/1pbrFQ-mcyijsVJNPP5GHbOeJaKdTLte3#scrollTo=kLU4xy3XLQG3">OneHotEncoder</a> .</p>
</div>
</div>
</div>
<div class="section" id="scaler">
<h3><span class="section-number">8.2.12. </span>Scaler<a class="headerlink" href="#scaler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">MaxAbsScaler</span>

<span class="n">scaler_type</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span>
<span class="k">if</span> <span class="n">scaler_type</span><span class="o">==</span><span class="s1">&#39;Normal&#39;</span><span class="p">:</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">Normalizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">scaler_type</span><span class="o">==</span><span class="s1">&#39;Standard&#39;</span><span class="p">:</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">,</span>
                            <span class="n">withStd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withMean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">scaler_type</span><span class="o">==</span><span class="s1">&#39;MinMaxScaler&#39;</span><span class="p">:</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">scaler_type</span><span class="o">==</span><span class="s1">&#39;MaxAbsScaler&#39;</span><span class="p">:</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MaxAbsScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">scaler</span><span class="p">])</span>

<span class="n">model</span>  <span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span>      <span class="n">features</span><span class="o">|</span>
<span class="o">+---+--------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+--------------+</span>

<span class="o">+---+--------------+------------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span>      <span class="n">features</span><span class="o">|</span>    <span class="n">scaledFeatures</span><span class="o">|</span>
<span class="o">+---+--------------+------------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.625</span><span class="p">,</span><span class="mf">0.125</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+--------------+------------------+</span>
</pre></div>
</div>
<div class="section" id="normalizer">
<h4><span class="section-number">8.2.12.1. </span>Normalizer<a class="headerlink" href="#normalizer" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="c1"># Normalize each Vector using $L^1$ norm.</span>
<span class="n">normalizer</span> <span class="o">=</span> <span class="n">Normalizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;normFeatures&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">l1NormData</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized using L^1 norm&quot;</span><span class="p">)</span>
<span class="n">l1NormData</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Normalize each Vector using $L^\infty$ norm.</span>
<span class="n">lInfNormData</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">,</span> <span class="p">{</span><span class="n">normalizer</span><span class="o">.</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized using L^inf norm&quot;</span><span class="p">)</span>
<span class="n">lInfNormData</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Normalized</span> <span class="n">using</span> <span class="n">L</span><span class="o">^</span><span class="mi">1</span> <span class="n">norm</span>
<span class="o">+---+--------------+------------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span>      <span class="n">features</span><span class="o">|</span>      <span class="n">normFeatures</span><span class="o">|</span>
<span class="o">+---+--------------+------------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.4</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.625</span><span class="p">,</span><span class="mf">0.125</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+--------------+------------------+</span>

<span class="n">Normalized</span> <span class="n">using</span> <span class="n">L</span><span class="o">^</span><span class="n">inf</span> <span class="n">norm</span>
<span class="o">+---+--------------+--------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span>      <span class="n">features</span><span class="o">|</span>  <span class="n">normFeatures</span><span class="o">|</span>
<span class="o">+---+--------------+--------------+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span><span class="o">|</span>
<span class="o">+---+--------------+--------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="standardscaler">
<h4><span class="section-number">8.2.12.2. </span>StandardScaler<a class="headerlink" href="#standardscaler" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">MaxAbsScaler</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">,</span>
                            <span class="n">withStd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withMean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scaleredData</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">((</span><span class="n">dataFrame</span><span class="p">))</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="n">scaleredData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------------+------------------------------------------------------------+</span>
<span class="o">|</span><span class="nb">id</span> <span class="o">|</span><span class="n">features</span>      <span class="o">|</span><span class="n">scaledFeatures</span>                                              <span class="o">|</span>
<span class="o">+---+--------------+------------------------------------------------------------+</span>
<span class="o">|</span><span class="mi">0</span>  <span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.6546536707079772</span><span class="p">,</span><span class="mf">0.09352195295828244</span><span class="p">,</span><span class="o">-</span><span class="mf">0.6546536707079771</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>  <span class="o">|</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="mf">1.3093073414159544</span><span class="p">,</span><span class="mf">0.1870439059165649</span><span class="p">,</span><span class="mf">0.6546536707079771</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="mi">2</span>  <span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">2.618614682831909</span><span class="p">,</span><span class="mf">1.870439059165649</span><span class="p">,</span><span class="mf">1.3093073414159542</span><span class="p">]</span>    <span class="o">|</span>
<span class="o">+---+--------------+------------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="minmaxscaler">
<h4><span class="section-number">8.2.12.3. </span>MinMaxScaler<a class="headerlink" href="#minmaxscaler" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">MaxAbsScaler</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">)</span>
<span class="n">scaledData</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">((</span><span class="n">dataFrame</span><span class="p">))</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="n">scaledData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------------+-----------------------------------------------------------+</span>
<span class="o">|</span><span class="nb">id</span> <span class="o">|</span><span class="n">features</span>      <span class="o">|</span><span class="n">scaledFeatures</span>                                             <span class="o">|</span>
<span class="o">+---+--------------+-----------------------------------------------------------+</span>
<span class="o">|</span><span class="mi">0</span>  <span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>                                              <span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>  <span class="o">|</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="mf">0.3333333333333333</span><span class="p">,</span><span class="mf">0.05263157894736842</span><span class="p">,</span><span class="mf">0.6666666666666666</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2</span>  <span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>                                              <span class="o">|</span>
<span class="o">+---+--------------+-----------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="maxabsscaler">
<h4><span class="section-number">8.2.12.4. </span>MaxAbsScaler<a class="headerlink" href="#maxabsscaler" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">MaxAbsScaler</span>

<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MaxAbsScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaledFeatures&quot;</span><span class="p">)</span>
<span class="n">scaledData</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">((</span><span class="n">dataFrame</span><span class="p">))</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="n">scaledData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+--------------+----------------+</span>
<span class="o">|</span><span class="nb">id</span> <span class="o">|</span><span class="n">features</span>      <span class="o">|</span><span class="n">scaledFeatures</span>  <span class="o">|</span>
<span class="o">+---+--------------+----------------+</span>
<span class="o">|</span><span class="mi">0</span>  <span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>  <span class="o">|</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>   <span class="o">|</span>
<span class="o">|</span><span class="mi">2</span>  <span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>   <span class="o">|</span>
<span class="o">+---+--------------+----------------+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pca">
<h3><span class="section-number">8.2.13. </span>PCA<a class="headerlink" href="#pca" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)]),),</span>
        <span class="p">(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),),</span>
        <span class="p">(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]),)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;pcaFeatures&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;pcaFeatures&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------+</span>
<span class="o">|</span><span class="n">pcaFeatures</span>                                                <span class="o">|</span>
<span class="o">+-----------------------------------------------------------+</span>
<span class="o">|</span><span class="p">[</span><span class="mf">1.6485728230883807</span><span class="p">,</span><span class="o">-</span><span class="mf">4.013282700516296</span><span class="p">,</span><span class="o">-</span><span class="mf">5.524543751369388</span><span class="p">]</span> <span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">4.645104331781534</span><span class="p">,</span><span class="o">-</span><span class="mf">1.1167972663619026</span><span class="p">,</span><span class="o">-</span><span class="mf">5.524543751369387</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">6.428880535676489</span><span class="p">,</span><span class="o">-</span><span class="mf">5.337951427775355</span><span class="p">,</span><span class="o">-</span><span class="mf">5.524543751369389</span><span class="p">]</span> <span class="o">|</span>
<span class="o">+-----------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="dct">
<h3><span class="section-number">8.2.14. </span>DCT<a class="headerlink" href="#dct" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">DCT</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">14.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),)],</span> <span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>

<span class="n">dct</span> <span class="o">=</span> <span class="n">DCT</span><span class="p">(</span><span class="n">inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;featuresDCT&quot;</span><span class="p">)</span>

<span class="n">dctDf</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">dctDf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;featuresDCT&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+----------------------------------------------------------------+</span>
<span class="o">|</span><span class="n">featuresDCT</span>                                                     <span class="o">|</span>
<span class="o">+----------------------------------------------------------------+</span>
<span class="o">|</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.1480502970952693</span><span class="p">,</span><span class="mf">2.0000000000000004</span><span class="p">,</span><span class="o">-</span><span class="mf">2.7716385975338604</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">3.378492794482933</span><span class="p">,</span><span class="o">-</span><span class="mf">7.000000000000001</span><span class="p">,</span><span class="mf">2.9301512653149677</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">9.304453421915744</span><span class="p">,</span><span class="mf">11.000000000000002</span><span class="p">,</span><span class="mf">1.5579302036357163</span><span class="p">]</span>   <span class="o">|</span>
<span class="o">+----------------------------------------------------------------+</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="feature-selection">
<h2><span class="section-number">8.3. </span>Feature Selection<a class="headerlink" href="#feature-selection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lasso">
<h3><span class="section-number">8.3.1. </span>LASSO<a class="headerlink" href="#lasso" title="Permalink to this headline">¶</a></h3>
<p>Variable selection and the removal of correlated variables.  The Ridge method shrinks the coefficients of correlated variables while the LASSO method picks one variable and discards the others.  The elastic net penalty is a mixture of these two; if variables are correlated in groups then <img class="math" src="_images/math/963bb945eddb7c2dcfe004f123693ab495c55406.png" alt="\alpha=0.5"/> tends to select the groups as in or out. If α is close to 1, the elastic net performs much like the LASSO method and removes any degeneracies and wild behavior caused by extreme correlations.</p>
</div>
<div class="section" id="randomforest">
<h3><span class="section-number">8.3.2. </span>RandomForest<a class="headerlink" href="#randomforest" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/runawayhorse001/AutoFeatures">AutoFeatures</a> library based on RandomForest is coming soon………….</p>
</div>
</div>
<div class="section" id="unbalanced-data-undersampling">
<h2><span class="section-number">8.4. </span>Unbalanced data: Undersampling<a class="headerlink" href="#unbalanced-data-undersampling" title="Permalink to this headline">¶</a></h2>
<p>Since we use PySpark to deal with the big data, Undersampling for Unbalanced Classification is a useful method to deal with the Unbalanced data. Undersampling is a popular technique for unbalanced datasets to reduce the skew in class distributions. However, it is well-known that undersampling one class modifies the priors of the training set and consequently biases the posterior probabilities of a classifier. After you applied the Undersampling, you need to recalibrate the Probability <a class="reference external" href="https://www3.nd.edu/~dial/publications/dalpozzolo2015calibrating.pdf">Calibrating Probability with Undersampling for Unbalanced Classification</a>.</p>
<div class="figure align-center">
<img alt="_images/underSampling.png" src="_images/underSampling.png" />
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+-----+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+---+-----+</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>
<span class="o">+---+-----+</span>
</pre></div>
</div>
<div class="section" id="calculate-undersampling-ratio">
<h3><span class="section-number">8.4.1. </span>Calculate undersampling Ratio<a class="headerlink" href="#calculate-undersampling-ratio" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">round_up</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span> <span class="o">/</span> <span class="n">multiplier</span>

  <span class="c1"># drop missing value rows</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># under-sampling majority set</span>
<span class="n">label_Y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
<span class="n">label_N</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
<span class="n">sampleRatio</span> <span class="o">=</span> <span class="n">round_up</span><span class="p">(</span><span class="n">label_N</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="undersampling">
<h3><span class="section-number">8.4.2. </span>Undersampling<a class="headerlink" href="#undersampling" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">label_Y_sample</span> <span class="o">=</span> <span class="n">label_Y</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">sampleRatio</span><span class="p">)</span>
<span class="c1"># union minority set and the under-sampling majority set</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">label_N</span><span class="o">.</span><span class="n">unionAll</span><span class="p">(</span><span class="n">label_Y_sample</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---+-----+</span>
<span class="o">|</span> <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+---+-----+</span>
<span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>   <span class="n">No</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span><span class="o">|</span>  <span class="n">Yes</span><span class="o">|</span>
<span class="o">+---+-----+</span>
</pre></div>
</div>
</div>
<div class="section" id="recalibrating-probability">
<h3><span class="section-number">8.4.3. </span>Recalibrating Probability<a class="headerlink" href="#recalibrating-probability" title="Permalink to this headline">¶</a></h3>
<p>Undersampling is a popular technique for unbalanced datasets to reduce the skew in class distributions. However, it is well-known that undersampling one class modifies the priors of the training set and consequently biases the posterior probabilities of a classifier <a class="reference external" href="https://www3.nd.edu/~dial/publications/dalpozzolo2015calibrating.pdf">Calibrating Probability with Undersampling for Unbalanced Classification</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predication</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;adj_probability&#39;</span><span class="p">,</span><span class="n">sampleRatio</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">sampleRatio</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="regression.html" class="btn btn-neutral float-right" title="9. Regression" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="exploration.html" class="btn btn-neutral float-left" title="7. Data Exploration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Wenqiang Feng
      <span class="lastupdated">
        Last updated on Dec 27, 2021.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>